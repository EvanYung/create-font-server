<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>é€ å­—å‘€</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@unocss/reset/tailwind.min.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/element-plus@2.6.2/dist/index.css" />
  <style>
    [un-cloak] {
      display: none;
    }

    html,
    body {
      font-family: CustomFont, Microsoft YaHei, PingFangSC-Regular, sans-serif, -apple-system, BlinkMacSystemFont;
    }
  </style>
  <script>
    // pass unocss options
    window.__unocss = {
      theme: {
        colors: {
          clifford: '#da373d',
        },
      },
    }
  </script>
  <script src="https://cdn.jsdelivr.net/npm/@unocss/runtime/attributify.global.js"></script>
</head>

<body>
  <script type="importmap">
    {
      "imports": {
          "vue3-sfc-loader": "https://cdn.jsdelivr.net/npm/vue3-sfc-loader/dist/vue3-sfc-loader.esm.js",
          "vue": "https://unpkg.com/vue@3/dist/vue.esm-browser.prod.js",
          "element-plus": "https://unpkg.com/element-plus@latest/dist/index.full.min.mjs",
          "element-plus/es/": "https://unpkg.com/element-plus@latest/es/",
          "@vue/shared": "https://unpkg.com/@vue/shared@latest/dist/shared.esm-bundler.js",
          "lodash/": "https://unpkg.com/lodash-es@4/",
          "@popperjs/core": "https://unpkg.com/@popperjs/core@2/dist/esm",
          "normalize-wheel": "https://unpkg.com/@sxzz/normalize-wheel-es/index.js",
          "resize-observer-polyfill": "https://unpkg.com/resize-observer-polyfill@1.5/dist/ResizeObserver.es.js",
          "dayjs": "https://unpkg.com/dayjs/esm",
          "dayjs/": "https://unpkg.com/dayjs/esm/",
          "mitt": "https://unpkg.com/mitt/dist/mitt.mjs",
          "async-validator": "https://unpkg.com/async-validator@4/dist-web/index.js",
          "@vueuse/shared": "https://unpkg.com/@vueuse/shared/index.mjs",
          "@vueuse/core": "https://unpkg.com/@vueuse/core/index.mjs",
          "vue-demi": "https://unpkg.com/vue-demi/lib/v3/index.mjs",
          "fabric": "https://cdn.jsdelivr.net/npm/fabric@5.3.0/+esm",
          "svg-text-to-path": "https://cdn.jsdelivr.net/npm/svg-text-to-path@latest/+esm"
      }
  }
  </script>
  <div id="app" class="flex flex-col items-center justify-center h-screen bg-[#eaeaea]">
    <App></App>
  </div>
  <script type="module">
    import * as Vue from 'vue'
    import * as vueuse from '@vueuse/core'
    import { loadModule } from 'vue3-sfc-loader'
    import { createApp, ref, onMounted, defineAsyncComponent } from 'vue'
    import ElementPlus from 'element-plus'
    import ElementPlusZhCn from 'element-plus/es/locale/lang/zh-cn.mjs'
    import * as Elp from 'element-plus'
    import * as fabric from 'fabric'
    import SvgTextToPath from 'svg-text-to-path'

    setTimeout(async () => {
      const svgStr = `<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="400" height="400" viewBox="0 0 400 400" xml:space="preserve">
<desc>Created with Fabric.js 5.3.0</desc>
<defs>
</defs>
<rect x="0" y="0" width="100%" height="100%" fill="#fff"></rect>
<g transform="matrix(1 0 0 1 200.5 220)" style=""  >
		<text xml:space="preserve" font-family="SimSun" font-size="300" font-style="normal" font-weight="normal" style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-dashoffset: 0; stroke-linejoin: miter; stroke-miterlimit: 4; fill: rgb(0,0,0); fill-rule: nonzero; opacity: 1; white-space: pre;" ><tspan x="-150" y="94.24" >ã€‡</tspan></text>
</g>
<g transform="matrix(1 0 0 1 220.5 240)" style=""  >
		<text xml:space="preserve" font-family="SimSun" font-size="300" font-style="normal" font-weight="normal" style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-dashoffset: 0; stroke-linejoin: miter; stroke-miterlimit: 4; fill: rgb(0,0,0); fill-rule: nonzero; opacity: 1; white-space: pre;" ><tspan x="-150" y="94.24" >å‡ </tspan></text>
</g>
</svg>`

      const session = new SvgTextToPath(svgStr, {
        fonts: {
          SimSun: [
            {
              wght: 400,
              ital: 0,
              source: '/client/fonts/SimSun/SimSun.ttf'
            }
          ]
        }
      })
      await session.replaceAll()
      const out = session.getSvgString()

      console.log('ðŸš€ ~ handleSave ~ out:', out)
    }, 20)

    const options = {
      moduleCache: {
        vue: Vue,
        fabric,
        'svg-text-to-path': SvgTextToPath,
        '@vueuse/core': vueuse,
        'element-plus': Elp,
        'element-plus/es/locale/lang/zh-cn': ElementPlusZhCn,
      },
      async getFile(url) {
        const res = await fetch(url)
        if (!res.ok)
          throw Object.assign(new Error(res.statusText + ' ' + url), { res })
        return {
          getContentData: asBinary => asBinary ? res.arrayBuffer() : res.text(),
        }
      },
      addStyle(textContent) {
        const style = Object.assign(document.createElement('style'), { textContent })
        const ref = document.head.getElementsByTagName('style')[0] || null
        document.head.insertBefore(style, ref)
      },
    }

    const app = createApp({
      components: {
        'App': defineAsyncComponent(() => loadModule('/client/App.vue', options)),
      },
      setup() {
        const loading = ref(false)

        return {
          loading,
        }
      },
    })

    // app.use(ElementPlus)

    app.mount('#app')

  </script>

  <style></style>
</body>

</html>